import java.io.IOException;
import java.io.Reader;
import java.io.StringReader;

/** Jam Interpreter */
class Interpreter {

    /** Abstract Syntax Tree generated by the parser */
    private AST ast;

    /** Constructor */
    Interpreter(String fileName) throws IOException { this(new Parser(fileName)); }

    /** Constructor */
    Interpreter(Reader reader) { this(new Parser(reader)); }

    /** Constructor */
    Interpreter(Parser p) { this(p.parse()); }

    /** Constructor */
    Interpreter(AST ast) { this.ast = ast; }
    
    /** Type-checking for typed Jam */
    public static AST checkTypes(AST ast) {
        TypeCheck.check(ast);
        return ast;
    }

    /** Interprets the program using a call-by-value calling convention and a cons-by-value cons convention */
    public JamVal eagerEval() {
        ContextCheck.check(ast);
        TypeCheck.check(ast);
        return this.ast.accept(
                new ASTInterpreter(
                        new Empty<Binding>(),
                        new EvaluationPolicy(EvaluationType.BY_VALUE, EvaluationType.BY_VALUE)
                        )
                );
    }
    /** Interprets the program using a call-by-value calling convention and a cons-by-need cons convention */
    public JamVal lazyEval() {
        ContextCheck.check(ast);
        TypeCheck.check(ast);
        return this.ast.accept(
                new ASTInterpreter(
                        new Empty<Binding>(),
                        new EvaluationPolicy(EvaluationType.BY_VALUE, EvaluationType.BY_NEED)
                        )
                );
    }
}


